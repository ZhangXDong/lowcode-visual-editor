(function(e){function t(t){for(var o,c,u=t[0],l=t[1],i=t[2],d=0,f=[];d<u.length;d++)c=u[d],Object.prototype.hasOwnProperty.call(r,c)&&r[c]&&f.push(r[c][0]),r[c]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);s&&s(t);while(f.length)f.shift()();return a.push.apply(a,i||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,u=1;u<n.length;u++){var l=n[u];0!==r[l]&&(o=!1)}o&&(a.splice(t--,1),e=c(c.s=n[0]))}return e}var o={},r={app:0},a=[];function c(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=o,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(n,o,function(t){return e[t]}.bind(null,o));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var i=0;i<u.length;i++)t(u[i]);var s=l;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},6861:function(e,t,n){},"93f5":function(e,t,n){},"9b9b":function(e,t,n){"use strict";n("d792")},aa8c:function(e,t,n){},b2c2:function(e,t,n){},be46:function(e,t,n){},c365:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e623"),n("e379"),n("5dc8"),n("37e1");var o=n("7a23"),r=(n("6861"),{id:"app"});function a(e,t,n,a,c,u){var l=Object(o["M"])("visual-editor");return Object(o["D"])(),Object(o["i"])("div",r,[Object(o["m"])(l,{modelValue:e.jsonData,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.jsonData=t}),config:e.config,formData:e.formData,customProps:e.customProps},null,8,["modelValue","config","formData","customProps"])])}n("99af"),n("4de4"),n("4160"),n("d81d"),n("d3b7"),n("25f0"),n("159b");var c=n("2909"),u=(n("96cf"),n("1da1")),l=n("5530");function i(){var e=[],t={};return{componentList:e,componentMap:t,registry:function(n,o){var r=Object(l["a"])(Object(l["a"])({},o),{},{key:n});e.push(r),t[n]=r}}}function s(e){var t=e.component,n=e.top,o=e.left;return{componentKey:t.key,top:n,left:o,adjustPosition:!0,focus:!1,zIndex:0,width:0,height:0,hasResize:!1,props:{},model:{}}}var d=function(){var e="@@VISUAL_DRAG_PROVIDER";return{provide:function(t){Object(o["F"])(e,t)},inject:function(){return Object(o["q"])(e)}}}();function f(e,t){var n=Object(o["I"])(e());return Object(o["Y"])(e,(function(e){e!==n.value&&(n.value=e)})),{get value(){return n.value},set value(e){n.value!==e&&(n.value=e,t(e))}}}Object(o["n"])({props:{modelValue:{type:Object}},emits:{"update:modelValue":function(e){return!0}},setup:function(e,t){var n=f((function(){return e.modelValue}),(function(e){return t.emit("update:modelValue",e)}));return setTimeout((function(){n.value.blocks=[{componentKey:"text",top:100,left:100},{componentKey:"input",top:300,left:300}],n.value.container.width=50}),3e3),function(){return Object(o["m"])("div",null,[Object(o["l"])("自定义的输入框"),(n.value.blocks||[]).map((function(e){return Object(o["m"])("div",null,[e.componentKey])})),Object(o["m"])("div",null,[Object(o["l"])("containerWidth: "),n.value.container.width])])}}}),n("aa8c"),n("13d5"),n("b64b");var p,b=n("ade3");n("b2c2");(function(e){e["start"]="start",e["center"]="center",e["end"]="end"})(p||(p={}));var m,v=Object(o["n"])({props:{block:{type:Object,required:!0},component:{type:Object,required:!0}},setup:function(e){return function(){var t=e.component.resize||{},n=t.width,r=t.height,a=d.inject(),c=a.dragStart,u=a.dragEnd,l=function(){var t={startX:0,startY:0,startWidth:0,startHeight:0,startLeft:0,startTop:0,direction:{horizontal:p.start,vertical:p.start},dragging:!1},n=function(n,a){n.stopPropagation(),t={startX:n.clientX,startY:n.clientY,startWidth:e.block.width,startHeight:e.block.height,startLeft:e.block.left,startTop:e.block.top,direction:a,dragging:!1},document.addEventListener("mousemove",o),document.addEventListener("mouseup",r)},o=function(n){var o=t,r=o.startX,a=o.startY,u=o.startWidth,l=o.startHeight,i=o.startLeft,s=o.startTop,d=o.direction,f=o.dragging,b=n.clientX,m=n.clientY;f||(t.dragging=!0,c.emit()),d.horizontal===p.center&&(b=r),d.vertical===p.center&&(m=a);var v=b-r,j=m-a,O=e.block;d.vertical===p.start&&(j=-j,O.top=s-j),d.horizontal===p.start&&(v=-v,O.left=i-v);var h=u+v,g=l+j;O.width=h,O.height=g,O.hasResize=!0},r=function e(){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),t.dragging&&(t.dragging=!1,u.emit())};return n}();return Object(o["m"])(o["b"],null,[!!r&&Object(o["m"])(o["b"],null,[Object(o["m"])("div",{class:"block-resize block-resize-top",onMousedown:function(e){return l(e,{horizontal:p.center,vertical:p.start})}},null),Object(o["m"])("div",{class:"block-resize block-resize-bottom",onMousedown:function(e){return l(e,{horizontal:p.center,vertical:p.end})}},null)]),!!n&&Object(o["m"])(o["b"],null,[Object(o["m"])("div",{class:"block-resize block-resize-left",onMousedown:function(e){return l(e,{horizontal:p.start,vertical:p.center})}},null),Object(o["m"])("div",{class:"block-resize block-resize-right",onMousedown:function(e){return l(e,{horizontal:p.end,vertical:p.center})}},null)]),!!n&&!!r&&Object(o["m"])(o["b"],null,[Object(o["m"])("div",{class:"block-resize block-resize-top-left",onMousedown:function(e){return l(e,{horizontal:p.start,vertical:p.start})}},null),Object(o["m"])("div",{class:"block-resize block-resize-top-right",onMousedown:function(e){return l(e,{horizontal:p.end,vertical:p.start})}},null),Object(o["m"])("div",{class:"block-resize block-resize-bottom-left",onMousedown:function(e){return l(e,{horizontal:p.start,vertical:p.end})}},null),Object(o["m"])("div",{class:"block-resize block-resize-bottom-right",onMousedown:function(e){return l(e,{horizontal:p.end,vertical:p.end})}},null)])])}}}),j=Object(o["n"])({props:{block:{type:Object,required:!0},config:{type:Object,required:!0},formData:{type:Object,required:!0},slots:{type:Object,required:!0},customProps:{type:Object}},setup:function(e){var t=Object(o["I"])({});Object(o["A"])((function(){var n=e.block;if(n.adjustPosition){var o=t.value,r=o.offsetWidth,a=o.offsetHeight;n.left=n.left-r/2,n.top=n.top-a/2,n.width=r,n.height=a,n.adjustPosition=!1}}));var n=Object(o["g"])((function(){return{left:"".concat(e.block.left,"px"),top:"".concat(e.block.top,"px"),zIndex:e.block.zIndex}})),r=Object(o["g"])((function(){return["visual-editor-block",{"visual-editor-block-focus":e.block.focus}]}));return function(){var a,c=e.config.componentMap[e.block.componentKey],u=e.formData;a=e.block.slotName&&e.slots[e.block.slotName]?e.slots[e.block.slotName]():c.render({props:e.block.props||{},size:e.block.hasResize?{width:e.block.width,height:e.block.height}:{},model:Object.keys(c.model||{}).reduce((function(t,n){var o,r=e.block.model?e.block.model[n]:null;return t[n]=(o={},Object(b["a"])(o,"default"===n?"modelValue":n,r?u[r]:null),Object(b["a"])(o,"default"===n?"onUpdate:modelValue":"onChange",(function(e){r&&(u[r]=e)})),o),t}),{}),custom:e.block.slotName&&e.customProps&&e.customProps[e.block.slotName]||{}});var l=c.resize||{},i=l.width,s=l.height;return Object(o["m"])("div",{class:r.value,style:n.value,ref:t},[a,!!e.block.focus&&(!!i||!!s)&&Object(o["m"])(v,{block:e.block,component:c},null)])}}}),O=j,h=(n("4fad"),n("3835"));function g(e){return{type:m.input,label:e}}function k(e){return{type:m.color,label:e}}function y(e,t){return{type:m.select,label:e,options:t}}function w(e,t){return{type:m.table,label:e,table:t}}(function(e){e["input"]="input",e["color"]="color",e["select"]="select",e["table"]="table"})(m||(m={}));var x=n("3fd4"),V=n("4979"),D=n.n(V),z=(n("c365"),n("a434"),function(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e}),E=Object(o["n"])({props:{option:{type:Object,required:!0}},setup:function(e){var t=Object(o["o"])(),n=Object(o["H"])({option:e.option,showFlag:!1,mounted:function(){var e=z();return Object(o["A"])((function(){return setTimeout((function(){return e.resolve()}),0)})),e.promise}(),editData:[]}),r={service:function(e){n.option=e,n.editData=D()(e.data||[]),r.show()},show:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.mounted;case 2:n.showFlag=!0;case 3:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),hide:function(){n.showFlag=!1},add:function(){n.editData.push({})},reset:function(){n.editData=D()(n.option.data)}},a={onCancel:function(){r.hide()},onConfirm:function(){n.option.onConfirm(n.editData),r.hide()},onDelete:function(e){n.editData.splice(e,1)}};return Object.assign(t.proxy,r),function(){return Object(o["m"])(x["c"],{modelValue:n.showFlag,"onUpdate:modelValue":function(e){return n.showFlag=e}},{default:function(){return Object(o["m"])("div",null,[Object(o["m"])("div",null,[Object(o["m"])(x["a"],Object(o["t"])({type:"primary"},{onClick:r.add}),{default:function(){return[Object(o["l"])("添加")]}}),Object(o["m"])(x["a"],{onClick:r.reset},{default:function(){return[Object(o["l"])("重置")]}})]),Object(o["m"])(x["k"],{data:n.editData},{default:function(){return[Object(o["m"])(x["l"],{type:"index"},null),n.option.config.table.options.map((function(e){return Object(o["m"])(x["l"],{label:e.label},{default:function(t){var n=t.row;return Object(o["m"])(x["f"],{modelValue:n[e.field],"onUpdate:modelValue":function(t){return n[e.field]=t}},null)}})})),Object(o["m"])(x["l"],{label:"操作栏"},{default:function(e){var t=e.$index;return Object(o["m"])(x["a"],Object(o["t"])({type:"danger"},{onClick:function(){return a.onDelete(t)}}),{default:function(){return[Object(o["l"])("删除")]}})}})]}})])},footer:function(){return Object(o["m"])(o["b"],null,[Object(o["m"])(x["a"],{onClick:a.onCancel},{default:function(){return[Object(o["l"])("取消")]}}),Object(o["m"])(x["a"],Object(o["t"])({type:"primary"},{onClick:a.onConfirm}),{default:function(){return[Object(o["l"])("确定")]}})])}})}}}),C=function(){var e;return function(t){if(!e){var n=document.createElement("div");document.body.appendChild(n);var r=Object(o["h"])(E,{option:t});e=r.mount(n)}var a=z();return e.service(Object(l["a"])(Object(l["a"])({},t),{},{onConfirm:a.resolve})),a.promise}}(),M=Object(o["n"])({props:{modelValue:{type:Array},propConfig:{type:Object,required:!0}},emits:{"update:modelValue":function(e){return!0}},setup:function(e,t){var n=f((function(){return e.modelValue}),(function(e){return t.emit("update:modelValue",e)})),r=function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C({config:e.propConfig,data:e.modelValue||[]});case 2:o=t.sent,n.value=o;case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return function(){return Object(o["m"])("div",null,[(!n.value||0==n.value.length)&&Object(o["m"])(x["a"],{onClick:r},{default:function(){return[Object(o["l"])("添加")]}}),(n.value||[]).map((function(t){return Object(o["m"])(x["m"],{onClick:r},{default:function(){return[t[e.propConfig.table.showKey]]}})}))])}}});function F(e){return"function"===typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!Object(o["s"])(e)}var L,P=Object(o["n"])({props:{block:{type:Object},config:{type:Object,required:!0},dataModel:{type:Object,required:!0},updateBlock:{type:Function,required:!0},updateModelValue:{type:Function,required:!0}},setup:function(e){var t=Object(o["H"])({editData:""});Object(o["Y"])((function(){return e.block}),(function(n){t.editData=n?D()(n||{}):D()(e.dataModel.value.container)}),{immediate:!0});var n={apply:function(){if(e.block){var n=t.editData;e.updateBlock(n,e.block)}else e.updateModelValue(Object(l["a"])(Object(l["a"])({},e.dataModel.value),{},{container:t.editData}))},reset:function(){e.block?t.editData=D()(e.block||{}):t.editData=D()(e.dataModel.value.container)}},r=function(e,n){var r;return(r={},Object(b["a"])(r,m.input,(function(){return Object(o["m"])(x["f"],{modelValue:t.editData.props[e],"onUpdate:modelValue":function(n){return t.editData.props[e]=n}},null)})),Object(b["a"])(r,m.color,(function(){return Object(o["m"])(x["b"],{modelValue:t.editData.props[e],"onUpdate:modelValue":function(n){return t.editData.props[e]=n}},null)})),Object(b["a"])(r,m.select,(function(){var r;return Object(o["m"])(x["j"],{modelValue:t.editData.props[e],"onUpdate:modelValue":function(n){return t.editData.props[e]=n}},F(r=function(){return n.options.map((function(e){return Object(o["m"])(x["i"],{label:e.label,value:e.val},null)}))}())?r:{default:function(){return[r]}})})),Object(b["a"])(r,m.table,(function(){return Object(o["m"])(M,{modelValue:t.editData.props[e],"onUpdate:modelValue":function(n){return t.editData.props[e]=n},propConfig:n},null)})),r)[n.type]()};return function(){var a=[];if(e.block){var c,u=e.block.componentKey,l=e.config.componentMap[u];a.push(Object(o["m"])(x["e"],{label:"组件标识"},F(c=Object(o["m"])(x["f"],{modelValue:t.editData.slotName,"onUpdate:modelValue":function(e){return t.editData.slotName=e}},null))?c:{default:function(){return[c]}})),l&&(l.props&&a.push(Object(o["m"])(o["b"],null,[Object.entries(l.props||{}).map((function(e){var t,n=Object(h["a"])(e,2),a=n[0],c=n[1];return Object(o["m"])(x["e"],{label:c.label,key:a},F(t=r(a,c))?t:{default:function(){return[t]}})}))])),l.model&&a.push(Object(o["m"])(o["b"],null,[Object.entries(l.model||{}).map((function(e){var n,r=Object(h["a"])(e,2),a=r[0],c=r[1];return Object(o["m"])(x["e"],{label:c},F(n=Object(o["m"])(x["f"],{modelValue:t.editData.model[a],"onUpdate:modelValue":function(e){return t.editData.model[a]=e}},null))?n:{default:function(){return[n]}})}))])))}else{var i,s;a.push(Object(o["m"])(o["b"],null,[Object(o["m"])(x["e"],{label:"容器宽度"},F(i=Object(o["m"])(x["g"],Object(o["t"])({modelValue:t.editData.width,"onUpdate:modelValue":function(e){return t.editData.width=e}},{step:100}),null))?i:{default:function(){return[i]}}),Object(o["m"])(x["e"],{label:"容器高度"},F(s=Object(o["m"])(x["g"],Object(o["t"])({modelValue:t.editData.height,"onUpdate:modelValue":function(e){return t.editData.height=e}},{step:100}),null))?s:{default:function(){return[s]}})]))}return Object(o["m"])("div",{class:"visual-editor-operator"},[Object(o["m"])(x["d"],{labelPosition:"top"},{default:function(){return[a,Object(o["m"])(x["e"],null,{default:function(){return[Object(o["m"])(x["a"],{onClick:n.reset},{default:function(){return[Object(o["l"])("重置")]}}),Object(o["m"])(x["a"],Object(o["t"])({type:"primary"},{onClick:n.apply}),{default:function(){return[Object(o["l"])("应用")]}})]}})]}})])}}}),B=(n("c975"),n("a15b"),n("fb6a"),n("b0c0"),{16:"shift",17:"ctrl",18:"alt",8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",46:"delete",189:"-",187:"=",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12"});function S(){var e=Object(o["H"])({current:-1,queue:[],commands:{},commandArray:[],destroyList:[]}),t=function(t){e.commandArray.push(t),e.commands[t.name]=function(){var n=t.execute.apply(t,arguments),o=n.undo,r=n.redo;if(r(),!1!==t.followQueue){var a=e.queue,c=e.current;a.length>0&&(a=a.slice(0,c+1),e.queue=a),a.push({undo:o,redo:r}),e.current=c+1}},t.init&&t.init()},n=function(){var t=function(t){if(document.activeElement===document.body){var n=t.keyCode,o=t.shiftKey,r=t.altKey,a=t.ctrlKey,c=t.metaKey,u=[];(a||c)&&u.push("ctrl"),o&&u.push("shift"),r&&u.push("alt"),u.push(B[n]);var l=u.join("+");e.commandArray.forEach((function(n){var o=n.keyboard,r=n.name;if(o){var a=Array.isArray(o)?o:[o];a.indexOf(l)>-1&&(e.commands[r](),t.stopPropagation(),t.preventDefault())}}))}},n=function(){return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}};return n}(),r=function(){e.commandArray.forEach((function(t){return!!t.init&&e.destroyList.push(t.init())})),e.destroyList.push(n())};return t({name:"undo",keyboard:"ctrl+z",followQueue:!1,execute:function(){return{undo:function(){console.log("undo撤销")},redo:function(){if(-1!==e.current){var t=e.queue[e.current].undo;t&&t(),e.current-=1}}}}}),t({name:"redo",keyboard:["ctrl+y","ctrl+shift+z"],followQueue:!1,execute:function(){return{undo:function(){console.log("redo撤销")},redo:function(){var t=e.queue[e.current+1];t&&(t.redo(),e.current++)}}}}),Object(o["B"])((function(){e.destroyList.forEach((function(e){return!!e&&e()}))})),{state:e,register:t,init:r}}function q(e){var t=e.focusData,n=e.updateBlocks,o=e.dataModel,r=e.dragStart,a=e.dragEnd,u=S();return u.init(),u.register({name:"delete",keyboard:["backspace","delete","ctrl+d"],execute:function(){console.log("执行删除命令",n);var e={before:o.value.blocks,after:t.value.unFocus};return{undo:function(){console.log("撤回删除命令"),n(e.before)},redo:function(){console.log("redo删除命令"),n(e.after)}}}}),u.register({name:"drag",init:function(){var e=this;this.data={before:null};var t={dragstart:function(){e.data.before=D()(o.value.blocks)},dragend:function(){u.state.commands.drag()}};return r.on(t.dragstart),a.on(t.dragend),function(){console.log("拖拽-销毁订阅"),r.off(t.dragstart),a.off(t.dragend)}},execute:function(){var e=this.data.before,t=D()(o.value.blocks);return{undo:function(){console.log("undo撤回拖拽命令",e),n(D()(e))},redo:function(){console.log("redo拖拽命令",t),n(D()(t))}}}}),u.register({name:"clear",execute:function(){var e={before:D()(o.value.blocks),after:D()([])};return{undo:function(){console.log("undo撤回清空命令",e.before),n(D()(e.before))},redo:function(){console.log("redo清空命令",e.after),n(D()(e.after))}}}}),u.register({name:"placeTop",keyboard:"ctrl+up",execute:function(){var e={before:D()(o.value.blocks),after:D()(function(){var e=t.value,n=e.focus,r=e.unFocus,a=r.reduce((function(e,t){return Math.max(e,t.zIndex)}),0)+1;return n.forEach((function(e){return e.zIndex=a})),D()(o.value.blocks)}())};return{undo:function(){console.log("undo撤回置顶命令",e.before),n(D()(e.before))},redo:function(){console.log("redo置顶命令",e.after),n(D()(e.after))}}}}),u.register({name:"placeBottom",keyboard:"ctrl+down",execute:function(){var e={before:D()(o.value.blocks),after:D()(function(){var e=t.value,n=e.focus,r=e.unFocus,a=r.reduce((function(e,t){return Math.min(e,t.zIndex)}),1/0)-1;if(a<0){var c=Math.abs(a);r.forEach((function(e){return e.zIndex+=c})),a=0}return n.forEach((function(e){return e.zIndex=a})),D()(o.value.blocks)}())};return{undo:function(){console.log("undo撤回置底命令",e.before),n(D()(e.before))},redo:function(){console.log("redo置底命令",e.after),n(D()(e.after))}}}}),u.register({name:"updateBlock",execute:function(e,t){var r=D()(o.value.blocks||[]),a={before:r,after:function(){r=Object(c["a"])(r);var n=o.value.blocks.indexOf(t);return n>-1&&r.splice(n,1,e),D()(r)}()};return{undo:function(){console.log("undo撤回更新单个block命令",a.before),n(D()(a.before))},redo:function(){console.log("redo更新单个block命令",a.after),n(D()(a.after))}}}}),u.register({name:"updateModelValue",execute:function(e){var t={before:D()(o.value),after:D()(e)};return{undo:function(){console.log("undo撤回更新dataModel命令",t.before),o.value=t.before},redo:function(){console.log("redo更新dataModel命令",t.after),o.value=t.after}}}}),u.register({name:"selectAll",followQueue:!1,keyboard:"ctrl+a",execute:function(e){return{undo:function(){console.log("undo撤回全选命令")},redo:function(){console.log("redo全选命令"),(o.value.blocks||[]).forEach((function(e){return e.focus=!0}))}}}}),console.log("commands",u.state),{undo:function(){return u.state.commands.undo()},redo:function(){return u.state.commands.redo()},delete:function(){return u.state.commands.delete()},drag:function(){return u.state.commands.drag()},clear:function(){return u.state.commands.clear()},placeTop:function(){return u.state.commands.placeTop()},placeBottom:function(){return u.state.commands.placeBottom()},updateBlock:function(e,t){return u.state.commands.updateBlock(e,t)},updateModuleValue:function(e){u.state.commands.updateModelValue(e)}}}function R(){var e=[];return{on:function(t){e.push(t)},off:function(t){var n=e.indexOf(t);n>-1&&e.splice(n,1)},emit:function(){e.forEach((function(e){return e()}))}}}(function(e){e["textarea"]="textarea",e["input"]="input"})(L||(L={}));var T=function(){var e=0;return function(){return"auto_key_".concat(e++)}}(),U=Object(o["n"])({props:{option:{type:Object,required:!0}},setup:function(e){var t=Object(o["o"])(),n=Object(o["H"])({option:e.option,editValue:null,showFlag:!1,key:T()}),r={service:function(e){n.option=e,n.editValue=e.editValue,n.key=T(),r.show()},show:function(){n.showFlag=!0},hide:function(){n.showFlag=!1}},a={onConfirm:function(){n.option.onConfirm(n.editValue),r.hide()},onCancel:function(){r.hide()}};return Object.assign(t.proxy,r),function(){return Object(o["m"])(x["c"],{modelValue:n.showFlag,"onUpdate:modelValue":function(e){return n.showFlag=e},title:n.option.title,key:n.key},{default:function(){return Object(o["m"])("div",null,[n.option.editType===L.textarea?Object(o["m"])(x["f"],Object(o["t"])({type:"textarea"},{row:20},{modelValue:n.editValue,"onUpdate:modelValue":function(e){return n.editValue=e}}),null):Object(o["m"])(x["f"],{modelValue:n.editValue,"onUpdate:modelValue":function(e){return n.editValue=e}},null)])},footer:function(){return Object(o["m"])("div",null,[Object(o["m"])(x["a"],{onClick:a.onCancel},{default:function(){return[Object(o["l"])("取消")]}}),Object(o["m"])(x["a"],{onClick:a.onConfirm},{default:function(){return[Object(o["l"])("确定")]}})])}})}}}),Y=function(){var e;return function(t){if(!e){var n=document.createElement("div");document.body.appendChild(n);var r=Object(o["h"])(U,{option:t});e=r.mount(n)}e.service(t)}}(),N=Object.assign(Y,{input:function(e,t,n){var o=z(),r=Object(l["a"])(Object(l["a"])({},n),{},{editType:L.input,editValue:e,onConfirm:o.resolve,title:t});return Y(r),o.promise},textarea:function(e,t,n){var o=z(),r=Object(l["a"])(Object(l["a"])({},n),{},{editType:L.textarea,editValue:e,onConfirm:o.resolve,title:t});return Y(r),o.promise}}),X=(n("be46"),function(){var e="@@DROPDOWN_SERVICE_PROVIDER";return{provide:function(t){return Object(o["F"])(e,t)},inject:function(){return Object(o["q"])(e)}}}()),I=Object(o["n"])({props:{option:{type:Object,required:!0}},setup:function(e){var t=Object(o["o"])(),n=Object(o["I"])({}),r=Object(o["H"])({option:e.option,showFlag:!1,top:0,left:0,mounted:function(){var e=z();return Object(o["A"])((function(){setTimeout((function(){e.resolve()}),0)})),e.promise}()}),a={show:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.mounted;case 2:r.showFlag=!0;case 3:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),hide:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.showFlag=!1;case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},c=function(e){if(r.option=e,"addEventListener"in e.reference){var t=e.reference.getBoundingClientRect(),n=t.top,o=t.left,c=t.height;r.left=o,r.top=n+c}else{var u=e.reference,l=u.clientX,i=u.clientY;r.left=l,r.top=i}a.show()},l=Object(o["g"])((function(){return["dropdown-service",{"dropdown-service-show":r.showFlag}]})),i=Object(o["g"])((function(){return{top:"".concat(r.top,"px"),left:"".concat(r.left,"px")}}));Object.assign(t.proxy,{service:c});var s=function(e){n.value.contains(e.target)||a.hide()};return Object(o["A"])((function(){return document.body.addEventListener("mousedown",s,!0)})),Object(o["x"])((function(){return document.body.removeEventListener("mousedown",s,!0)})),X.provide({onClick:a.hide}),function(){return Object(o["m"])("div",{class:l.value,style:i.value,ref:n},[r.option.render()])}}}),A=Object(o["n"])({props:{label:{type:String},icon:{type:String}},emits:{click:function(e){return!0}},setup:function(e,t){var n=X.inject(),r=n.onClick,a={onClick:function(e){t.emit("click",e),r()}};return function(){return Object(o["m"])("div",{class:"dropdown-option",onClick:a.onClick},[Object(o["m"])("i",{class:"iconfont ".concat(e.icon)},null),Object(o["m"])("span",null,[e.label])])}}}),K=function(){var e;return function(t){if(!e){var n=document.createElement("div");document.body.append(n);var r=Object(o["h"])(I,{option:t});e=r.mount(n)}e.service(t)}}();function H(e){return"function"===typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!Object(o["s"])(e)}var J=Object(o["n"])({components:{VisualEditorBlock:O,VisualEditorOperator:P},props:{modelValue:{type:Object,required:!0},config:{type:Object,required:!0},formData:{type:Object,required:!0},customProps:{type:Object}},emits:{"update:modelValue":function(e){return!0}},setup:function(e,t){var n=f((function(){return e.modelValue}),(function(e){return t.emit("update:modelValue",e)})),r=Object(o["I"])({}),a=Object(o["I"])(-1),i=Object(o["H"])({selectBlock:Object(o["g"])((function(){return(n.value.blocks||[])[a.value]})),preview:!0,editFlag:!0}),p=Object(o["g"])((function(){return["visual-editor",{"visual-editor-preview":i.preview}]})),b=Object(o["g"])((function(){return{width:"100%",height:"100%"}})),m=Object(o["g"])((function(){return{width:"".concat(n.value.container.width,"px"),height:"".concat(n.value.container.height,"px")}})),v={clearFocus:function(e){var t=n.value.blocks||[];t.length&&(t&&(t=t.filter((function(t){return t!==e}))),t.forEach((function(e){return e.focus=!1})))},updateBlocks:function(e){n.value=Object(l["a"])(Object(l["a"])({},n.value),{},{blocks:e}),console.log("dataModel.value :>> ",n.value)},showBlockData:function(e){N.textarea(JSON.stringify(e),"节点数据",{editReadonly:!0})},importBlockData:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,N.textarea("","请输入节点JSON字符串");case 2:n=e.sent;try{try{o=JSON.parse(n||""),V.updateBlock(o,t)}catch(r){console.error(r),x["h"].alert("解析JSON错误")}}catch(r){console.error(r)}case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),openEdit:function(){i.editFlag=!0}},j=R(),O=R();d.provide({dragStart:j,dragEnd:O});var h=function(){var e=null,t={dragenter:function(e){e.dataTransfer.dropEffect="move"},dragover:function(e){e.preventDefault()},dragleave:function(e){e.dataTransfer.dropEffect="none"}},o={dragstart:function(n,a){r.value.addEventListener("dragenter",t.dragenter),r.value.addEventListener("dragover",t.dragover),r.value.addEventListener("dragleave",t.dragleave),r.value.addEventListener("drop",o.drop),e=a,j.emit()},dragend:function(n){r.value.removeEventListener("dragenter",t.dragenter),r.value.removeEventListener("dragover",t.dragover),r.value.removeEventListener("dragleave",t.dragleave),r.value.removeEventListener("drop",o.drop),e=null},drop:function(t){var o=Object(c["a"])(n.value.blocks||[]);o.push(s({component:e,top:t.offsetY,left:t.offsetX})),v.updateBlocks(o),O.emit()}};return{dragStart:j,dragEnd:O,blockHandler:o}}(),g=Object(o["g"])((function(){var e=[],t=[];return(n.value.blocks||[]).forEach((function(n){return(n.focus?e:t).push(n)})),{focus:e,unFocus:t}})),k={container:{onMousedown:function(e){e.currentTarget===e.target&&(e.preventDefault(),i.preview||e.shiftKey||(v.clearFocus(),a.value=-1))}},block:{onMousedown:function(e,t,n){i.preview||(e.shiftKey?t.focus=!t.focus:t.focus||(t.focus=!0,v.clearFocus(t)),a.value=n,y.mousedown(e))}}},y=function(){var e=Object(o["H"])({x:null,y:null}),t={startX:0,startY:0,startLeft:0,startTop:0,startPos:[],dragging:!1,markLines:{}},r=function(e){t={startX:e.clientX,startY:e.clientY,startLeft:i.selectBlock.left,startTop:i.selectBlock.top,startPos:g.value.focus.map((function(e){var t=e.top,n=e.left;return{top:t,left:n}})),dragging:!1,markLines:function(){var e=g.value,t=(e.focus,e.unFocus),o=i.selectBlock,r=(o.top,o.left,o.width),a=o.height,u={x:[],y:[]};return[].concat(Object(c["a"])(t),[{top:0,left:0,width:n.value.container.width,height:n.value.container.height}]).forEach((function(e){var t=e.top,n=e.left,o=e.width,c=e.height;u.y.push({top:t,markY:t}),u.y.push({top:t+c,markY:t+c}),u.y.push({top:t+c/2-a/2,markY:t+c/2}),u.y.push({top:t-a,markY:t}),u.y.push({top:t+c-a,markY:t+c}),u.x.push({left:n,markX:n}),u.x.push({left:n+o,markX:n+o}),u.x.push({left:n+o/2-r/2,markX:n+o/2}),u.x.push({left:n-r,markX:n}),u.x.push({left:n+o-r,markX:n+o})})),u}()},document.addEventListener("mousemove",a),document.addEventListener("mouseup",u)},a=function(n){t.dragging||(t.dragging=!0,j.emit());var o=n.clientX,r=n.clientY,a=t,c=a.startX,u=a.startY,l=a.startLeft,i=a.startTop;n.shiftKey&&(Math.abs(o-c)>Math.abs(r-u)?r=u:o=c);for(var s=l+o-c,d=i+r-u,f={x:null,y:null},p=0;p<t.markLines.y.length;p++){var b=t.markLines.y[p],m=b.top,v=b.markY;if(Math.abs(m-d)<5){r=m+u-i,f.y=v;break}}for(var O=0;O<t.markLines.x.length;O++){var h=t.markLines.x[O],k=h.left,y=h.markX;if(Math.abs(k-s)<5){o=k+c-l,f.x=y;break}}e.x=f.x,e.y=f.y;var w=o-c,x=r-u;g.value.focus.forEach((function(e,n){e.top=t.startPos[n].top+x,e.left=t.startPos[n].left+w}))},u=function n(o){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",n),e.x=null,e.y=null,t.dragging&&O.emit()};return{mark:e,mousedown:r}}(),w={onContextmenuBlock:function(e,t){i.preview||(e.preventDefault(),e.stopPropagation(),K({reference:e,render:function(){return Object(o["m"])(o["b"],null,[Object(o["m"])(A,Object(o["t"])({label:"置顶节点",icon:"icon-place-top"},{onClick:V.placeTop}),null),Object(o["m"])(A,Object(o["t"])({label:"置底节点",icon:"icon-place-bottom"},{onClick:V.placeBottom}),null),Object(o["m"])(A,Object(o["t"])({label:"删除节点",icon:"icon-delete"},{onClick:V.delete}),null),Object(o["m"])(A,Object(o["t"])({label:"查看数据",icon:"icon-browse"},{onClick:function(){return v.showBlockData(t)}}),null),Object(o["m"])(A,Object(o["t"])({label:"导入节点",icon:"icon-import"},{onClick:function(){return v.importBlockData(t)}}),null)])}}))}},V=q({focusData:g,updateBlocks:v.updateBlocks,dataModel:n,dragStart:h.dragStart,dragEnd:h.dragEnd}),D=[{label:"撤销",icon:"icon-back",handler:V.undo,tip:"ctrl+z"},{label:"重做",icon:"icon-forward",handler:V.redo,tip:"ctrl+y, ctrl+shift+z"},{label:function(){return i.preview?"编辑":"预览"},icon:function(){return i.preview?"icon-edit":"icon-browse"},handler:function(){v.clearFocus(),i.preview=!i.preview}},{label:"导入",icon:"icon-import",handler:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,N.textarea("","请输入导入的JSON字符串");case 2:t=e.sent;try{o=JSON.parse(t||""),n.value=o}catch(r){console.error(r),x["h"].alert("解析JSON错误")}case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{label:"导出",icon:"icon-export",handler:function(){return N.textarea(JSON.stringify(n.value),"导出的JSON数据",{editReadonly:!0})}},{label:"置顶",icon:"icon-place-top",handler:function(){return V.placeTop()},tip:"ctrl+up"},{label:"置底",icon:"icon-place-bottom",handler:function(){return V.placeBottom()},tip:"ctrl+down"},{label:"删除",icon:"icon-back",handler:function(){return V.delete()},tip:"ctrl+d, backspace, delete"},{label:"清空",icon:"icon-reset",handler:function(){return V.clear()}},{label:"关闭",icon:"icon-close",handler:function(){v.clearFocus(),i.editFlag=!1,i.preview=!0}}];return function(){return Object(o["m"])(o["b"],null,[Object(o["m"])("div",{class:"visual-editor-mask"},[Object(o["m"])("div",{class:p.value},[Object(o["m"])("div",{class:"visual-editor-body"},[Object(o["m"])("div",{class:"visual-editor-head"},[Object(o["m"])("div",{class:"visual-editor-head-button",onClick:v.openEdit},[Object(o["l"])("去编辑")])]),Object(o["m"])("div",{class:"visual-editor-content"},[Object(o["m"])("div",{class:"visual-editor-canvas",style:b.value},[(n.value.blocks||[]).map((function(n,r){return Object(o["m"])(Object(o["M"])("visual-editor-block"),{block:n,config:e.config,key:r,formData:e.formData,slots:t.slots,customProps:e.customProps},null)})),null!==y.mark.y&&Object(o["m"])("div",{class:"visual-editor-mark-line-y",style:{top:"".concat(y.mark.y,"px")}},null),null!==y.mark.x&&Object(o["m"])("div",{class:"visual-editor-mark-line-x",style:{left:"".concat(y.mark.x,"px")}},null),Object(o["l"])("坐标---y:"),y.mark.y,Object(o["l"])("---x:"),y.mark.x])]),Object(o["m"])("div",null,[JSON.stringify(e.formData)])])])]),Object(o["bb"])(Object(o["m"])("div",{class:"visual-editor-mask"},[Object(o["m"])("div",{class:p.value},[Object(o["m"])("div",{class:"visual-editor-menu"},[e.config.componentList.map((function(e){return Object(o["m"])("div",{class:"visual-editor-menu-item",draggable:!0,onDragstart:function(t){return h.blockHandler.dragstart(t,e)},onDrop:h.blockHandler.drop},[Object(o["m"])("span",{class:"visual-editor-menu-item-label"},[e.label]),e.preview()])}))]),Object(o["m"])("div",{class:"visual-editor-body"},[Object(o["m"])("div",{class:"visual-editor-head"},[D.map((function(e,t){var n,r="function"===typeof e.label?e.label():e.label;return Object(o["m"])(Object(o["M"])("el-tooltip"),{effect:"dark",content:e.tip||e.label,placement:"bottom"},H(n=Object(o["m"])("div",{class:"visual-editor-head-button",key:t,onClick:e.handler},H(r)?r:{default:function(){return[r]}}))?n:{default:function(){return[n]}})}))]),Object(o["m"])("div",{class:"visual-editor-content"},[Object(o["m"])("div",Object(o["t"])({class:"visual-editor-canvas",style:m.value,ref:r},k.container),[Object(o["m"])("div",null,[Object(o["m"])("div",null,[Object(o["l"])("width: "),n.value.container.width]),Object(o["m"])("div",null,[Object(o["l"])("height: "),n.value.container.height]),Object(o["m"])("div",null,[Object(o["l"])("blocks: "),JSON.stringify(n.value.blocks)])]),(n.value.blocks||[]).map((function(n,r){return Object(o["m"])(Object(o["M"])("visual-editor-block"),Object(o["t"])({block:n,config:e.config,key:r,formData:e.formData,slots:t.slots,customProps:e.customProps},{onMousedown:function(e){return k.block.onMousedown(e,n,r)},onContextmenu:function(e){return w.onContextmenuBlock(e,n)}}),null)})),null!==y.mark.y&&Object(o["m"])("div",{class:"visual-editor-mark-line-y",style:{top:"".concat(y.mark.y,"px")}},null),null!==y.mark.x&&Object(o["m"])("div",{class:"visual-editor-mark-line-x",style:{left:"".concat(y.mark.x,"px")}},null),Object(o["l"])("坐标---y:"),y.mark.y,Object(o["l"])("---x:"),y.mark.x])])]),Object(o["m"])(Object(o["M"])("visual-editor-operator"),{block:i.selectBlock,config:e.config,dataModel:n,updateBlock:V.updateBlock,updateModelValue:V.updateModuleValue},null)])]),[[o["X"],i.editFlag]])])}}}),_=(n("93f5"),Object(o["n"])({props:{start:{type:String},end:{type:String}},emits:{"update:start":function(e){return!0},"update:end":function(e){return!0}},setup:function(e,t){var n=f((function(){return e.start}),(function(e){return t.emit("update:start",e)})),r=f((function(){return e.end}),(function(e){return t.emit("update:end",e)}));return function(){return Object(o["m"])("div",{class:"number-range"},[Object(o["bb"])(Object(o["m"])("input",{type:"text","onUpdate:modelValue":function(e){return n.value=e}},null),[[o["W"],n.value]]),Object(o["m"])("span",null,[Object(o["l"])("-")]),Object(o["bb"])(Object(o["m"])("input",{type:"text","onUpdate:modelValue":function(e){return r.value=e}},null),[[o["W"],r.value]])])}}}));function W(e){return"function"===typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!Object(o["s"])(e)}var Q=i();Q.registry("text",{label:"文本",preview:function(){return"预览文本"},render:function(e){var t=e.props;return Object(o["m"])("span",{style:{color:t.color,fontSize:t.size}},[t.text||"默认文本"])},props:{text:g("显示文本"),color:k("字体颜色"),size:y("字体大小",[{label:"14px",val:"14px"},{label:"18px",val:"18px"},{label:"24px",val:"24px"}])}}),Q.registry("button",{label:"按钮",preview:function(){return Object(o["m"])(x["a"],null,{default:function(){return[Object(o["l"])("按钮")]}})},render:function(e){var t=e.props,n=e.size,r=e.custom;return Object(o["m"])(x["a"],Object(o["t"])(r,{type:t.type,size:t.size,style:{width:n.width?"".concat(n.width,"px"):null,height:n.height?"".concat(n.height,"px"):null}}),{default:function(){return[t.text||"默认按钮"]}})},props:{text:g("显示文本"),type:y("按钮类型",[{label:"基础",val:"primary"},{label:"成功",val:"success"},{label:"警告",val:"warning"},{label:"危险",val:"danger"},{label:"提示",val:"info"},{label:"文本",val:"text"}]),size:y("按钮大小",[{label:"默认",val:""},{label:"中等",val:"medium"},{label:"小",val:"small"},{label:"极小",val:"mini"}])},resize:{width:!0,height:!0}}),Q.registry("select",{label:"下拉框",preview:function(){return Object(o["m"])(x["j"],null,null)},render:function(e){var t,n=e.props,r=e.model,a=e.custom;return Object(o["m"])(x["j"],Object(o["t"])(a,{key:(n.options||[]).map((function(e){return e.value})).join(",")},r.default),W(t=(n.options||[]).map((function(e,t){return Object(o["m"])(x["i"],{label:e.label,value:e.value,key:t},null)})))?t:{default:function(){return[t]}})},props:{options:w("下拉选项",{options:[{label:"显示值",field:"label"},{label:"绑定值",field:"value"},{label:"备注",field:"comments"}],showKey:"label"})},model:{default:"绑定字段"}}),Q.registry("input",{label:"输入框",preview:function(){return Object(o["m"])(x["f"],{modelValue:""},null)},render:function(e){var t=e.model,n=e.size,r=e.custom;return Object(o["m"])(x["f"],Object(o["t"])(r,t.default,{style:{width:n.width?"".concat(n.width,"px"):null}}),null)},model:{default:"绑定字段"},resize:{width:!0}}),Q.registry("number-range",{label:"数字范围输入框",preview:function(){return Object(o["m"])(_,null,null)},render:function(e){var t=e.model,n=e.size;return Object(o["m"])(_,Object(o["t"])({style:{width:"".concat(n.width,"px")}},{start:t.start.value,"onUpdate:start":t.start.onChange,end:t.end.value,"onUpdate:end":t.end.onChange}),null)},model:{start:"起始绑定字段",end:"结束绑定字段"},resize:{width:!0}}),Q.registry("image",{label:"图片",preview:function(){return Object(o["m"])("img",{alt:"图片alt"},null)},render:function(e){var t=e.props,n=e.size;return Object(o["m"])("div",{style:{height:"".concat(n.height||200,"px"),width:"".concat(n.width||200,"px")},class:"visual-block-img"},[Object(o["m"])("img",{src:t.url||"http://cn.vuejs.org/images/logo.png"},null)])},props:{url:g("地址")},resize:{width:!0,height:!0}});var $=Object(o["n"])({name:"App",components:{VisualEditor:J},data:function(){var e=this;return{val:"111",formData:{username:"admin"},config:Q,jsonData:{container:{width:1e3,height:1e3},blocks:[]},customProps:{subBtn:{onClick:function(){e.$notify({message:"执行表单数据校验以及添加到服务器的动作"})}},mySelect:{onChange:function(t){e.$notify({message:"下拉框发生变化，".concat(t)})}}}}}});n("9b9b");$.render=a;var G=$,Z=(n("7dd6"),Object(o["h"])(G));Z.use(x["n"]),Z.mount("#app")},d792:function(e,t,n){}});
//# sourceMappingURL=app.a8426ea2.js.map